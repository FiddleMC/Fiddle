--- a/net/minecraft/world/item/ItemStack.java
+++ b/net/minecraft/world/item/ItemStack.java
@@ -190,18 +_,67 @@
         return new StreamCodec<RegistryFriendlyByteBuf, ItemStack>() {
             @Override
             public ItemStack decode(RegistryFriendlyByteBuf buffer) {
+                // Fiddle start - Item mapping - Reverse - Apply at ItemStack decoding
+                return this.decode(buffer, true);
+            }
+
+            public ItemStack decode(RegistryFriendlyByteBuf buffer, boolean attemptReversing) {
+                // Fiddle end - Item mapping - Reverse - Apply at ItemStack decoding
                 int varInt = buffer.readVarInt();
                 if (varInt <= 0) {
                     return ItemStack.EMPTY;
                 } else {
                     Holder<Item> holder = Item.STREAM_CODEC.decode(buffer);
                     DataComponentPatch dataComponentPatch = codec.decode(buffer);
-                    return new ItemStack(holder, varInt, dataComponentPatch);
+                    // Fiddle start - Item mapping - Reverse - Apply at ItemStack decoding
+                    ItemStack received = new ItemStack(holder, varInt, dataComponentPatch);
+                    if (attemptReversing) {
+                        org.fiddlemc.fiddle.impl.packetmapping.item.reverse.@Nullable ItemMappingReverser itemMappingReverser = ((org.fiddlemc.fiddle.impl.clientview.ClientViewImpl) buffer.getClientViewOrFallback()).getItemMappingReverser();
+                        if (itemMappingReverser != null) {
+                            received = itemMappingReverser.reverseMappingIfPossible(received);
+                        }
+                    }
+                    return received;
+                    // Fiddle end - Item mapping - Reverse - Apply at ItemStack decoding
                 }
             }
 
             @Override
             public void encode(RegistryFriendlyByteBuf buffer, ItemStack value) {
+                // Fiddle start - Item mapping - Implementation - Apply at ItemStack encoding
+                org.fiddlemc.fiddle.impl.packetmapping.item.ItemMappingFunctionContextImpl itemMappingContext = new org.fiddlemc.fiddle.impl.packetmapping.item.ItemMappingFunctionContextImpl(buffer.getClientViewOrFallback(), buffer.isEncodingItemFrameItem, buffer.isEncodingStonecutterRecipeResult);
+                org.fiddlemc.fiddle.impl.packetmapping.item.reverse.@Nullable ItemMappingReverser itemMappingReverser = ((org.fiddlemc.fiddle.impl.clientview.ClientViewImpl) buffer.getClientViewOrFallback()).getItemMappingReverser();
+                ItemStack mappedValue = org.fiddlemc.fiddle.impl.packetmapping.item.ItemMappingsImpl.get().apply(value, itemMappingContext);
+                if (itemMappingReverser != null) {
+                    long reservedId = -1;
+                    if (mappedValue != value) {
+                        reservedId = itemMappingReverser.reserveAndAttachId(mappedValue, value);
+                    }
+                    int writerIndexBeforeEncoding = buffer.writerIndex();
+                    this.encodeUnmapped(buffer, mappedValue);
+                    int readerIndexBeforeReading = buffer.readerIndex();
+                    buffer.readerIndex(writerIndexBeforeEncoding);
+                    ItemStack actuallySent = this.decode(buffer, false);
+                    buffer.readerIndex(readerIndexBeforeReading);
+                    if (!matches(actuallySent, mappedValue)) {
+                        if (reservedId == -1) {
+                            mappedValue = mappedValue.copy();
+                        }
+                        reservedId = itemMappingReverser.reserveAndAttachId(actuallySent, value);
+                        itemMappingReverser.attachId(mappedValue, reservedId);
+                        buffer.writerIndex(writerIndexBeforeEncoding);
+                        this.encodeUnmapped(buffer, mappedValue);
+                    }
+                    if (reservedId != -1) {
+                        itemMappingReverser.storeAsReversible(reservedId, actuallySent);
+                    }
+                } else {
+                    this.encodeUnmapped(buffer, mappedValue);
+                }
+            }
+
+            private void encodeUnmapped(RegistryFriendlyByteBuf buffer, ItemStack value) {
+                // Fiddle end - Item mapping - Implementation - Apply at ItemStack encoding
                 if (value.isEmpty() || value.getItem() == null) { // CraftBukkit - NPE fix itemstack.getItem()
                     buffer.writeVarInt(0);
                 } else {
